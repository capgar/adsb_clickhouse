-- ============================================================================
-- ClickHouse User Management for ADS-B Database
-- ============================================================================

-- Create Ingestion User (write access to all tables)
CREATE USER IF NOT EXISTS adsb_ingest ON CLUSTER `adsb-data`
    IDENTIFIED WITH sha256_password BY 'CHANGEME'
    SETTINGS PROFILE 'default';

-- Create Query User (read-only access)
CREATE USER IF NOT EXISTS adsb_query ON CLUSTER `adsb-data`
    IDENTIFIED WITH sha256_password BY 'CHANGEME'
    SETTINGS PROFILE 'default';

-- ============================================================================
-- Grant Permissions
-- ============================================================================

-- Ingestion user: SELECT and INSERT on all tables
GRANT SELECT, INSERT ON adsb.positions_local TO adsb_ingest ON CLUSTER `adsb-data`;
GRANT SELECT, INSERT ON adsb.positions_regional TO adsb_ingest ON CLUSTER `adsb-data`;
GRANT SELECT, INSERT ON adsb.positions_global TO adsb_ingest ON CLUSTER `adsb-data`;
GRANT SELECT, INSERT ON adsb.positions_local_replacing TO adsb_ingest ON CLUSTER `adsb-data`;
GRANT SELECT, INSERT ON adsb.positions_regional_replacing TO adsb_ingest ON CLUSTER `adsb-data`;
GRANT SELECT, INSERT ON adsb.positions_global_replacing TO adsb_ingest ON CLUSTER `adsb-data`;
GRANT SELECT, INSERT ON adsb.positions_local_latest TO adsb_ingest ON CLUSTER `adsb-data`;
GRANT SELECT, INSERT ON adsb.positions_regional_latest TO adsb_ingest ON CLUSTER `adsb-data`;
GRANT SELECT, INSERT ON adsb.positions_global_latest TO adsb_ingest ON CLUSTER `adsb-data`;

-- Query user: SELECT only on all tables
GRANT SELECT ON adsb.positions_local TO adsb_query ON CLUSTER `adsb-data`;
GRANT SELECT ON adsb.positions_regional TO adsb_query ON CLUSTER `adsb-data`;
GRANT SELECT ON adsb.positions_global TO adsb_query ON CLUSTER `adsb-data`;
GRANT SELECT ON adsb.positions_local_replacing TO adsb_query ON CLUSTER `adsb-data`;
GRANT SELECT ON adsb.positions_regional_replacing TO adsb_query ON CLUSTER `adsb-data`;
GRANT SELECT ON adsb.positions_global_replacing TO adsb_query ON CLUSTER `adsb-data`;
GRANT SELECT ON adsb.positions_local_latest TO adsb_query ON CLUSTER `adsb-data`;
GRANT SELECT ON adsb.positions_regional_latest TO adsb_query ON CLUSTER `adsb-data`;
GRANT SELECT ON adsb.positions_global_latest TO adsb_query ON CLUSTER `adsb-data`;
GRANT SELECT ON system.* TO adsb_query on cluster `adsb-data`;

-- ============================================================================
-- Verify Permissions
-- ============================================================================

-- Show grants for ingestion user
-- SHOW GRANTS FOR adsb_ingest;

-- Show grants for query user
-- SHOW GRANTS FOR adsb_query;
